<!DOCTYPE html>
<html>
  <head>
      <script>
  var _hmt = _hmt || []
  ;(function() {
    var hm = document.createElement('script')
    hm.src = 'https://hm.baidu.com/hm.js?5a0acc897fd96474a2c8f4deac84611a'
    var s = document.getElementsByTagName('script')[0]
    s.parentNode.insertBefore(hm, s)
  })()
</script> 
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="keywords" content="null" />
    <meta name="description" content="" />
    
    <title>
      华为杯-大连理工大学第12届大学生程序设计大赛题解 - Welcome to sher-wu&#39;s home !
    </title>
    <link rel="manifest" href="/manifest.json" />
    <link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="/style/style.css">
  </head>
  <body>
    
    <div id="post-toc" class="animated hiddenToc hide">
      <span class="title">Toc</span>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#华为杯大连理工大学第12届大学生程序设计大赛题解"><span class="toc-text">&quot;华为杯&quot;大连理工大学第12届大学生程序设计大赛题解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#a.-字符三角形"><span class="toc-text">A. 字符三角形</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#n.-蓝桥杯爆零"><span class="toc-text">N. 蓝桥杯！爆零！</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#m.-后缀自动机求回旋字符串"><span class="toc-text">M. 后缀自动机求回旋字符串</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#h.-自定义排序"><span class="toc-text">H. 自定义排序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#d.-爱在公元前"><span class="toc-text">D. 爱在公元前</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#i.-oj的反作弊系统"><span class="toc-text">I. OJ的反作弊系统</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#c.-耀宗学长的图像处理课本"><span class="toc-text">C. 耀宗学长的图像处理课本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#k.-取模运算"><span class="toc-text">K. 取模运算</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#f.-菜鸟工程师的分子划分"><span class="toc-text">F. 菜鸟工程师的分子划分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#l.-七星堆六朝墓群"><span class="toc-text">L. 七星堆六朝墓群</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#b.-立方和"><span class="toc-text">B. 立方和</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#g.-牙签自动机"><span class="toc-text">G. 牙签自动机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#e.-膜法项链-easy-version"><span class="toc-text">E. 膜法项链 Easy Version</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#e.-膜法项链-hard-version"><span class="toc-text">E. 膜法项链 Hard Version</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#j.-更强的未来道具fg-c193-easy-version"><span class="toc-text">J. 更强的未来道具FG-C193 Easy Version</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#j.-更强的未来道具fg-c193-hard-version"><span class="toc-text">J. 更强的未来道具FG-C193 Hard Version</span></a></li></ol></li></ol></li></ol>
    </div>
    
    <div id="fixed-menu-wrap">
      <span class="iconfont icon-sousuo search-box menu-reset"></span>
      <span class="icon-toc menu-reset">Toc</span>
      <span class="iconfont icon-arrowup menu-reset"></span>
    </div>
    <div id="fixed-menu">
      <span class="iconfont icon-menu-"></span>
    </div>
    <div id="progress">
      <div class="line"></div>
    </div>
    <div id="search-shade" class="animated hiddenSearch hide">
      <div class="input-wrap">
        <span class="iconfont icon-sousuo search-box"></span>
        <input type="text" placeholder="Search" />
        <span class="iconfont icon-close"></span>
      </div>
      <div class="search-result">
        <div class="meta">
          <span><b id="result-count">0</b> results found</span>
          <img src="/images/logo.jpeg" />
        </div>
        <ul id="result-box"></ul>
      </div>
    </div>
    <div id="menu-mask" class="animated hideMenuMask hide">
      <span class="iconfont icon-close"></span>
      <div class="nav">
        
        <a href="/" class="">
          Home
        </a>
        
        <a href="/archives" class="">
          Archives
        </a>
        
        <a href="/categories" class="">
          Categories
        </a>
        
        <a href="/tags" class="">
          Tags
        </a>
        
        <a href="/friends" class="">
          Friends
        </a>
        
        <a href="/about" class="">
          About
        </a>
        
      </div>
    </div>
    <div id="header">
      <div class="intro">
        <a href="/" class="logo" style="background-image: url('/images/logo.jpeg')"></a>
        <div class="author">sher-wu</div>
      </div>
      <div class="nav">
        <span class="iconfont icon-menu menu-icon"></span>
        <a href="#" class="search-box">
          <span class="iconfont icon-sousuo"></span>
        </a>
      </div>
    </div>
    <div id="side" class="animated bounceInLeft">
      <div class="shrink">
        <a href="/" class="logo" style="background-image: url('/images/logo.jpeg')"></a>
        <span class="iconfont icon-menu toggle-icon"></span>
        <a href="#" class="search-box">
          <span class="iconfont icon-sousuo"></span>
        </a>
      </div>
      <div class="magnify">
        <div class="about">
          <div class="author">sher-wu</div>
          <a href="/" class="logo" style="background-image: url('/images/logo.jpeg')"></a>
        </div>

        <div class="nav">
          
          <a href="/" class="">
            Home
          </a>
          
          <a href="/archives" class="">
            Archives
          </a>
          
          <a href="/categories" class="">
            Categories
          </a>
          
          <a href="/tags" class="">
            Tags
          </a>
          
          <a href="/friends" class="">
            Friends
          </a>
          
          <a href="/about" class="">
            About
          </a>
          
          <a href="#" class="search-box">
            <span class="iconfont icon-sousuo"></span>
          </a>
        </div>
        <div class="bottom">
          <div class="follow">
            
            <a href="https://github.com/sher-wu" target="_block">
              <span class="iconfont icon-github"></span>
            </a>
            
            <a href="http://wpa.qq.com/msgrd?v=3&amp;uin=425099035&amp;site=qq&amp;menu=yes" target="_block">
              <span class="iconfont icon-QQ"></span>
            </a>
             
            <a href="/atom.xml" target="_block">
              <span class="iconfont icon-rss"></span>
            </a>
            
          </div>
        </div>
      </div>
    </div>
    <div id="container">
      <div class="main animated bounceInRight delay-0.7s">
        <article class="post-entry">
    <div class="header">
      
      <div class="title">华为杯-大连理工大学第12届大学生程序设计大赛题解</div>
      <div class="meta">
        <span class="item">
          <span class="iconfont icon-time-circle"></span>
          <span>2019/12/11</span>
        </span>

        

         
        <span class="item">
          <span class="iconfont icon-folder"></span>
          <span>
              
                
                  <a href="/categories/Solution">Solution</a>
                
              
          </span>
        </span>
        
        
        
      </div>
      <div>
      </div>
    </div>
    <h1 id="华为杯大连理工大学第12届大学生程序设计大赛题解">"华为杯"大连理工大学第12届大学生程序设计大赛题解<a class="post-anchor" href="#华为杯大连理工大学第12届大学生程序设计大赛题解"></a></h1>
<p><strong>Problem Designer / Porter: funer, cscyuge, Kinesis, Zeraful, ggwdwsbs</strong></p>
<p><strong>Solution Author: Yzm007, Coca, Kinesis, sher_wu</strong></p>
<p><strong><a href="http://10.8.128.203:7217/problemset.php?page=4" target="_blank" rel="noopener">戳我补题</a></strong></p>
<p><strong>难度排序：</strong></p>
<p>Easy：ANM</p>
<p>Easy-Middle：HDI</p>
<p>Middle：CK</p>
<p>Middle-Hard：FLBG</p>
<p>Hard：EJ</p>
<h3 id="a.-字符三角形">A. 字符三角形<a class="post-anchor" href="#a.-字符三角形"></a></h3>
<blockquote>
<p>签到题。</p>
</blockquote>
<h3 id="n.-蓝桥杯爆零">N. 蓝桥杯！爆零！<a class="post-anchor" href="#n.-蓝桥杯爆零"></a></h3>
<blockquote>
<p>即统计积最多能被10整除几次，积中出现了几个10。 而10可以被分解成2*5，即统计n个数中共出现了几次2和5，取小即可。</p>
</blockquote>
<pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;
<span class="hljs-keyword">int</span> n,v,two,five;
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>&#123;
    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>,&amp;n);
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;++i)
    &#123;
        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>,&amp;v);
        <span class="hljs-keyword">for</span>(;v%<span class="hljs-number">2</span>==<span class="hljs-number">0</span>;v/=<span class="hljs-number">2</span>)two++;
        <span class="hljs-keyword">for</span>(;v%<span class="hljs-number">5</span>==<span class="hljs-number">0</span>;v/=<span class="hljs-number">5</span>)five++;
    &#125;
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d\n"</span>,<span class="hljs-built_in">min</span>(two,five));
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
&#125;</code></pre>
<h3 id="m.-后缀自动机求回旋字符串">M. 后缀自动机求回旋字符串<a class="post-anchor" href="#m.-后缀自动机求回旋字符串"></a></h3>
<blockquote>
<p>长度为奇显然为NO，考虑长度为偶，此处以长度为8的s串为例。<br>
1 2 3 4 5 6 7 8 若此串合法，需s[1]=s[5]，s[2]=s[6]，…<br>
考虑后挪一位得到新串2 3 4 1，发现仍需满足上式。<br>
因此直接判断即可，可以推广到长度为2*n的情形。<br>
事实上，如将串首尾相接形成一个环，该操作相当于重新选择环的起点，但无论执行多少次操作，当前字母仍应与其相距为n的字母相同。</p>
</blockquote>
<pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N=<span class="hljs-number">1e6</span>+<span class="hljs-number">10</span>;
<span class="hljs-keyword">char</span> s[N];
<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">ok</span><span class="hljs-params">(<span class="hljs-keyword">int</span> n)</span>
</span>&#123;
    <span class="hljs-keyword">if</span>(n%<span class="hljs-number">2</span>)<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    n/=<span class="hljs-number">2</span>;
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;n;++i)
    <span class="hljs-keyword">if</span>(s[i]!=s[i+n])<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
&#125;
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>&#123;
    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%s"</span>,s);
    <span class="hljs-keyword">int</span> len=<span class="hljs-built_in">strlen</span>(s);
    <span class="hljs-built_in">puts</span>(ok(len)?<span class="hljs-string">"YES"</span>:<span class="hljs-string">"NO"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
&#125;</code></pre>
<h3 id="h.-自定义排序">H. 自定义排序<a class="post-anchor" href="#h.-自定义排序"></a></h3>
<blockquote>
<p>按题意排序，使用一种<span class="math inline">\(O(nlogn)\)</span>的排序方式即可通过，或使用STL。</p>
</blockquote>
<pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N=<span class="hljs-number">1e5</span>+<span class="hljs-number">5</span>;
<span class="hljs-keyword">int</span> n,oa,ob,oc;
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">node</span>
&#123;</span>
    <span class="hljs-keyword">int</span> a,b,c;
&#125;e[N];
<span class="hljs-keyword">bool</span> <span class="hljs-keyword">operator</span>&lt;(node x,node y)
&#123;
    <span class="hljs-keyword">if</span>(x.a!=y.a)<span class="hljs-keyword">return</span> oa?x.a&lt; y.a:x.a&gt;y.a;
    <span class="hljs-keyword">if</span>(x.b!=y.b)<span class="hljs-keyword">return</span> ob?x.b&lt; y.b:x.b&gt;y.b;
    <span class="hljs-keyword">if</span>(x.c!=y.c)<span class="hljs-keyword">return</span> oc?x.c&lt; y.c:x.c&gt;y.c;
&#125;
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>&#123;
    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d%d%d"</span>,&amp;n,&amp;oa,&amp;ob,&amp;oc);
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;n;++i)
    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d%d"</span>,&amp;e[i].a,&amp;e[i].b,&amp;e[i].c);
    sort(e,e+n);
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;n;++i)
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d %d %d\n"</span>,e[i].a,e[i].b,e[i].c);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
&#125;</code></pre>
<h3 id="d.-爱在公元前">D. 爱在公元前<a class="post-anchor" href="#d.-爱在公元前"></a></h3>
<blockquote>
<p>考虑一个月日只可能对应一个年，且9220年02月29日合法，所以先将366个合法日期处理出来。 对于每个询问日期tmp，暴力判断366个日期哪个小于等于tmp即可。</p>
</blockquote>
<pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;
<span class="hljs-keyword">int</span> t,dat[]=&#123;<span class="hljs-number">0</span>,<span class="hljs-number">31</span>,<span class="hljs-number">29</span>,<span class="hljs-number">31</span>,<span class="hljs-number">30</span>,<span class="hljs-number">31</span>,<span class="hljs-number">30</span>,<span class="hljs-number">31</span>,<span class="hljs-number">31</span>,<span class="hljs-number">30</span>,<span class="hljs-number">31</span>,<span class="hljs-number">30</span>,<span class="hljs-number">31</span>&#125;;
<span class="hljs-keyword">int</span> cnt,y,m,d;
<span class="hljs-keyword">char</span> s[<span class="hljs-number">10</span>];
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">node</span>
&#123;</span>
    <span class="hljs-keyword">int</span> y,m,d;
&#125;e[<span class="hljs-number">367</span>],tmp;
<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">cmp</span><span class="hljs-params">(node a,node b)</span>
</span>&#123;
    <span class="hljs-keyword">if</span>(a.y!=b.y)<span class="hljs-keyword">return</span> a.y&lt;b.y;
    <span class="hljs-keyword">if</span>(a.m!=b.m)<span class="hljs-keyword">return</span> a.m&lt;b.m;
    <span class="hljs-keyword">if</span>(a.d!=b.d)<span class="hljs-keyword">return</span> a.d&lt;b.d;
    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
&#125;
<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">leap</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span>
</span>&#123;
    <span class="hljs-keyword">if</span>(x%<span class="hljs-number">400</span>==<span class="hljs-number">0</span>||(x%<span class="hljs-number">100</span> &amp;&amp; x%<span class="hljs-number">4</span>==<span class="hljs-number">0</span>))<span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
&#125;
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span>
</span>&#123;
    <span class="hljs-keyword">int</span> y;
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">1</span>;i&lt;=<span class="hljs-number">12</span>;++i)
    &#123;
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j=<span class="hljs-number">1</span>;j&lt;=<span class="hljs-number">31</span>;++j)
        &#123;
            <span class="hljs-keyword">if</span>(j&gt;dat[i])<span class="hljs-keyword">break</span>;
            y=i/<span class="hljs-number">10</span>+(i%<span class="hljs-number">10</span>)*<span class="hljs-number">10</span>+(j/<span class="hljs-number">10</span>)*<span class="hljs-number">100</span>+(j%<span class="hljs-number">10</span>)*<span class="hljs-number">1000</span>;
            <span class="hljs-keyword">if</span>(!leap(y) &amp;&amp; (i==<span class="hljs-number">2</span>&amp;&amp;j==<span class="hljs-number">29</span>))<span class="hljs-keyword">break</span>;
            e[++cnt]=node&#123;y,i,j&#125;;
        &#125;
    &#125;
&#125;
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>&#123;
    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>,&amp;t);
    init();
    <span class="hljs-keyword">while</span>(t--)
    &#123;
        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%s"</span>,s);
        y=m=d=<span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">4</span>;++i)
        y=y*<span class="hljs-number">10</span>+(s[i]-<span class="hljs-string">'0'</span>);
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">4</span>;i&lt;<span class="hljs-number">6</span>;++i)
        m=m*<span class="hljs-number">10</span>+(s[i]-<span class="hljs-string">'0'</span>);
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">6</span>;i&lt;<span class="hljs-number">8</span>;++i)
        d=d*<span class="hljs-number">10</span>+(s[i]-<span class="hljs-string">'0'</span>);
        tmp=node&#123;y,m,d&#125;;
        <span class="hljs-keyword">int</span> ans=<span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">1</span>;i&lt;=cnt;++i)
        <span class="hljs-keyword">if</span>(cmp(e[i],tmp))ans++;
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d\n"</span>,ans);
    &#125;
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
&#125;</code></pre>
<h3 id="i.-oj的反作弊系统">I. OJ的反作弊系统<a class="post-anchor" href="#i.-oj的反作弊系统"></a></h3>
<blockquote>
<p>按题意二分，二分的位置越界即答案不存在，或使用STL。 小于等于v的最大位置即大于v的最小位置-1。 同理，小于v的最大位置即大于等于v的最小位置-1。</p>
</blockquote>
<pre><code class="hljs c++"><span class="hljs-comment">//手写二分</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N=<span class="hljs-number">2e5</span>+<span class="hljs-number">10</span>;
<span class="hljs-keyword">int</span> n,m,v,x[N],pos,ans;
<span class="hljs-keyword">char</span> s[<span class="hljs-number">5</span>];
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">upper</span><span class="hljs-params">(<span class="hljs-keyword">int</span> l,<span class="hljs-keyword">int</span> r,<span class="hljs-keyword">int</span> v)</span>
</span>&#123;
    <span class="hljs-keyword">int</span> mid;
    <span class="hljs-keyword">while</span>(l&lt;=r)
    &#123;
        mid=(l+r)/<span class="hljs-number">2</span>;
        <span class="hljs-keyword">if</span>(x[mid]&lt;=v)l=mid+<span class="hljs-number">1</span>;
        <span class="hljs-keyword">else</span> r=mid<span class="hljs-number">-1</span>;
    &#125;
    <span class="hljs-keyword">return</span> l;
&#125;
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">lower</span><span class="hljs-params">(<span class="hljs-keyword">int</span> l,<span class="hljs-keyword">int</span> r,<span class="hljs-keyword">int</span> v)</span>
</span>&#123;
    <span class="hljs-keyword">int</span> mid;
    <span class="hljs-keyword">while</span>(l&lt;=r)
    &#123;
        mid=(l+r)/<span class="hljs-number">2</span>;
        <span class="hljs-keyword">if</span>(x[mid]&lt;v)l=mid+<span class="hljs-number">1</span>;
        <span class="hljs-keyword">else</span> r=mid<span class="hljs-number">-1</span>;
    &#125;
    <span class="hljs-keyword">return</span> l;
&#125;
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>&#123;
    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d"</span>,&amp;n,&amp;m);
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;++i)
    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>,&amp;x[i]);
    sort(x+<span class="hljs-number">1</span>,x+n+<span class="hljs-number">1</span>);
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">1</span>;i&lt;=m;++i)
    &#123;
        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%s%d"</span>,s,&amp;v);
        <span class="hljs-keyword">char</span> op=s[<span class="hljs-number">0</span>];
        <span class="hljs-keyword">if</span>(op==<span class="hljs-string">'A'</span>)
        &#123;
            pos=upper(<span class="hljs-number">1</span>,n,v);
            <span class="hljs-keyword">if</span>(pos&gt;n)<span class="hljs-built_in">puts</span>(<span class="hljs-string">"-1"</span>);
            <span class="hljs-keyword">else</span> <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d\n"</span>,pos);
        &#125;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(op==<span class="hljs-string">'B'</span>)
        &#123;
            pos=lower(<span class="hljs-number">1</span>,n,v);
            pos--;
            <span class="hljs-keyword">if</span>(pos&lt;<span class="hljs-number">1</span>)<span class="hljs-built_in">puts</span>(<span class="hljs-string">"-1"</span>);
            <span class="hljs-keyword">else</span> <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d\n"</span>,pos);
        &#125;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(op==<span class="hljs-string">'C'</span>)
        &#123;
            pos=lower(<span class="hljs-number">1</span>,n,v);
            <span class="hljs-keyword">if</span>(pos&gt;n)<span class="hljs-built_in">puts</span>(<span class="hljs-string">"-1"</span>);
            <span class="hljs-keyword">else</span> <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d\n"</span>,pos);
        &#125;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(op==<span class="hljs-string">'D'</span>)
        &#123;
            pos=upper(<span class="hljs-number">1</span>,n,v);
            pos--;
            <span class="hljs-keyword">if</span>(pos&lt;<span class="hljs-number">1</span>)<span class="hljs-built_in">puts</span>(<span class="hljs-string">"-1"</span>);
            <span class="hljs-keyword">else</span> <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d\n"</span>,pos);
        &#125;
    &#125;
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
&#125;</code></pre>
<pre><code class="hljs c++"><span class="hljs-comment">//STL</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N=<span class="hljs-number">2e5</span>+<span class="hljs-number">10</span>;
<span class="hljs-keyword">int</span> n,m,v,x[N],pos,ans;
<span class="hljs-keyword">char</span> s[<span class="hljs-number">5</span>];
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>&#123;
    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d"</span>,&amp;n,&amp;m);
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;++i)
    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>,&amp;x[i]);
    sort(x+<span class="hljs-number">1</span>,x+n+<span class="hljs-number">1</span>);
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">1</span>;i&lt;=m;++i)
    &#123;
        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%s%d"</span>,s,&amp;v);
        <span class="hljs-keyword">char</span> op=s[<span class="hljs-number">0</span>];
        <span class="hljs-keyword">if</span>(op==<span class="hljs-string">'A'</span>)
        &#123;
            pos=upper_bound(x+<span class="hljs-number">1</span>,x+n+<span class="hljs-number">1</span>,v)-x;
            <span class="hljs-keyword">if</span>(pos&gt;n)<span class="hljs-built_in">puts</span>(<span class="hljs-string">"-1"</span>);
            <span class="hljs-keyword">else</span> <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d\n"</span>,pos);
        &#125;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(op==<span class="hljs-string">'B'</span>)
        &#123;
            pos=lower_bound(x+<span class="hljs-number">1</span>,x+n+<span class="hljs-number">1</span>,v)-x;
            pos--;
            <span class="hljs-keyword">if</span>(pos&lt;<span class="hljs-number">1</span>)<span class="hljs-built_in">puts</span>(<span class="hljs-string">"-1"</span>);
            <span class="hljs-keyword">else</span> <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d\n"</span>,pos);
        &#125;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(op==<span class="hljs-string">'C'</span>)
        &#123;
            pos=lower_bound(x+<span class="hljs-number">1</span>,x+n+<span class="hljs-number">1</span>,v)-x;
            <span class="hljs-keyword">if</span>(pos&gt;n)<span class="hljs-built_in">puts</span>(<span class="hljs-string">"-1"</span>);
            <span class="hljs-keyword">else</span> <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d\n"</span>,pos);
        &#125;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(op==<span class="hljs-string">'D'</span>)
        &#123;
            pos=upper_bound(x+<span class="hljs-number">1</span>,x+n+<span class="hljs-number">1</span>,v)-x;
            pos--;
            <span class="hljs-keyword">if</span>(pos&lt;<span class="hljs-number">1</span>)<span class="hljs-built_in">puts</span>(<span class="hljs-string">"-1"</span>);
            <span class="hljs-keyword">else</span> <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d\n"</span>,pos);
        &#125;
    &#125;
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
&#125;</code></pre>
<h3 id="c.-耀宗学长的图像处理课本">C. 耀宗学长的图像处理课本<a class="post-anchor" href="#c.-耀宗学长的图像处理课本"></a></h3>
<blockquote>
<p>原题题号UVA297，开始出了<span class="math inline">\(dep&gt;5\)</span>的数据，向被卡这道题的参赛选手抱歉。 做法较多，可以根据实际矩形递归建树，也可以只利用树形递归建树，先序遍历这棵树。 遇见字母<span class="math inline">\(p\)</span>就向下递归4个位置，遇到字母<span class="math inline">\(f\)</span>就统计答案。</p>
</blockquote>
<pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstdio&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstring&gt;</span></span>
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> len = <span class="hljs-number">32</span>;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> maxn = <span class="hljs-number">1024</span> + <span class="hljs-number">10</span>;
<span class="hljs-keyword">char</span> s[maxn];
<span class="hljs-keyword">int</span> buf[len][len], cnt;
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">draw</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *s, <span class="hljs-keyword">int</span> &amp;p, <span class="hljs-keyword">int</span> r, <span class="hljs-keyword">int</span> c, <span class="hljs-keyword">int</span> w)</span>
</span>&#123;
    <span class="hljs-keyword">char</span> ch = s[p++];
    <span class="hljs-keyword">if</span> (ch == <span class="hljs-string">'p'</span>)
    &#123;
        draw(s, p, r, c + w / <span class="hljs-number">2</span>, w / <span class="hljs-number">2</span>);
        draw(s, p, r, c, w / <span class="hljs-number">2</span>);
        draw(s, p, r + w / <span class="hljs-number">2</span>, c, w / <span class="hljs-number">2</span>);
        draw(s, p, r + w / <span class="hljs-number">2</span>, c + w / <span class="hljs-number">2</span>, w / <span class="hljs-number">2</span>);
    &#125;
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ch == <span class="hljs-string">'f'</span>)
    &#123;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = r; i &lt; r + w; i++)
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = c; j &lt; c + w; j++)
                <span class="hljs-keyword">if</span> (buf[i][j] == <span class="hljs-number">0</span>)
                &#123;
                    buf[i][j] = <span class="hljs-number">1</span>;
                    cnt++;
                &#125;
    &#125;
&#125;

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>&#123;
    <span class="hljs-keyword">int</span> T;
    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;T);
    <span class="hljs-keyword">while</span> (T--)
    &#123;
        <span class="hljs-built_in">memset</span>(buf, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(buf));
        cnt = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2</span>; i++)
        &#123;
            <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%s"</span>, s);
            <span class="hljs-keyword">int</span> p = <span class="hljs-number">0</span>;
            draw(s, p, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, len);
        &#125;
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"There are %d black pixels.\n"</span>, cnt);
    &#125;
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
&#125;</code></pre>
<h3 id="k.-取模运算">K. 取模运算<a class="post-anchor" href="#k.-取模运算"></a></h3>
<blockquote>
<p>分块，优雅的暴力。<br>
考虑最暴力的回答2询问的方式，<span class="math inline">\(tong[x]\)</span>代表<span class="math inline">\(x\)</span>的值的个数，遍历<span class="math inline">\(x, x+p, x+2p, ...,\)</span>直至上限<span class="math inline">\({10}^{5}\)</span>，累加<span class="math inline">\(tong\)</span>的值，所需次数大致为<span class="math inline">\(\frac{ {10}^{5}}{p}\)</span>。<br>
对于<span class="math inline">\(p\geq \sqrt{ {10}^{5}}\)</span>的询问，单次所需次数不超过<span class="math inline">\(\sqrt{ {10}^{5}}\)</span>，可以接受。<br>
对于<span class="math inline">\(p&lt;\sqrt{ {10}^{5}}\)</span>的询问，暴力显然超时，开二维数组预存所有<span class="math inline">\(p&lt; \sqrt{ {10}^{5}}\)</span>的答案，now[p][x]代表<span class="math inline">\(\%p ==x\)</span>的值的个数<span class="math inline">\((p&lt;\sqrt{ {10}^{5}},x&lt;p )\)</span>.<br>
针对每次单点修改，及时更新tong和now数组的值。<br>
针对每次询问，若<span class="math inline">\(p\geq \sqrt{ {10}^{5}}\)</span>，暴力统计，否则直接回答now[][x]的值。<br>
复杂度为<span class="math inline">\(O(n\sqrt{n})\)</span>。</p>
</blockquote>
<pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N=<span class="hljs-number">1e5</span>+<span class="hljs-number">10</span>;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> M=<span class="hljs-built_in">sqrt</span>(N)+<span class="hljs-number">5</span>;
<span class="hljs-keyword">int</span> n,m,op,x,y,a[N],ans;
<span class="hljs-keyword">int</span> now[M][M],tong[N];
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>&#123;
    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d"</span>,&amp;n,&amp;m);
    <span class="hljs-keyword">int</span> sq=<span class="hljs-built_in">sqrt</span>(N);
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;++i)
    &#123;
        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>,&amp;a[i]);
        tong[a[i]]++;
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j=<span class="hljs-number">1</span>;j&lt;=sq;++j)
        now[j][a[i]%j]++;
    &#125;
    <span class="hljs-keyword">while</span>(m--)
    &#123;
        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d%d"</span>,&amp;op,&amp;x,&amp;y);
        <span class="hljs-keyword">if</span>(op==<span class="hljs-number">1</span>)
        &#123;
            <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j=<span class="hljs-number">1</span>;j&lt;=sq;++j)
            &#123;
                now[j][a[x]%j]--;
                now[j][y%j]++;
            &#125;
            tong[a[x]]--;
            tong[y]++;
            a[x]=y;
        &#125;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(op==<span class="hljs-number">2</span>)
        &#123;
            <span class="hljs-keyword">if</span>(x&gt;=y)ans=<span class="hljs-number">0</span>;
            <span class="hljs-keyword">else</span>
            &#123;
                <span class="hljs-keyword">if</span>(y&lt;=sq)ans=now[y][x];
                <span class="hljs-keyword">else</span>
                &#123;
                    ans=<span class="hljs-number">0</span>;
                    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=x;i&lt;N;i+=y)
                    ans+=tong[i];
                &#125;
            &#125;
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d\n"</span>,ans);
        &#125;
    &#125;
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
&#125;</code></pre>
<h3 id="f.-菜鸟工程师的分子划分">F. 菜鸟工程师的分子划分<a class="post-anchor" href="#f.-菜鸟工程师的分子划分"></a></h3>
<blockquote>
<p>题意：<br>
平面上有n个点，不是白点就是黑点。现在要放一条直线，使得直线一侧的白点与另一侧的黑点加起来数目最多。直线上的点可以看作位于直线的任意一侧。<br>
思路：<br>
首先假设直线经过两个点，否则可以移动直线使其经过两个点，并且总数不会减少。<br>
所以，我们可以先枚举一个基点，然后以这个点为中心。<br>
围绕基点将其他点按照极角排序，将直线旋转，统计符合要求的点的个数。<br>
需要注意的是，如果将所有的黑点以基点为中心做一个中心对称，则符合要求的点的个数就变成了直线一侧的点的个数。</p>
</blockquote>
<pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;cstdio&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;cmath&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;cstring&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;algorithm&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;

<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> maxn = <span class="hljs-number">1000</span> + <span class="hljs-number">5</span>;

<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Point</span>
&#123;</span>
    <span class="hljs-keyword">int</span> x, y;
    <span class="hljs-keyword">double</span> rad; <span class="hljs-comment">// with respect to current point</span>
    <span class="hljs-keyword">bool</span> <span class="hljs-keyword">operator</span>&lt;(<span class="hljs-keyword">const</span> Point &amp;rhs) <span class="hljs-keyword">const</span>
    &#123;
        <span class="hljs-keyword">return</span> rad &lt; rhs.rad;
    &#125;
&#125; op[maxn], p[maxn];
<span class="hljs-keyword">int</span> n, color[maxn];
<span class="hljs-comment">// from O-A to O-B, is it a left turn?</span>

<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">Left</span><span class="hljs-params">(Point A, Point B)</span>
</span>&#123;
    <span class="hljs-keyword">return</span> A.x * B.y - A.y * B.x &gt;= <span class="hljs-number">0</span>;
&#125;

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">solve</span><span class="hljs-params">()</span>
</span>&#123;
    <span class="hljs-keyword">if</span>(n &lt;= <span class="hljs-number">2</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>;
    <span class="hljs-keyword">int</span> ans = <span class="hljs-number">0</span>;
    <span class="hljs-comment">// pivot point</span>
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++)&#123;
        <span class="hljs-keyword">int</span> k = <span class="hljs-number">0</span>;
        <span class="hljs-comment">// the list of other point, sorted in increasing order of rad</span>
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; n; j++)
            <span class="hljs-keyword">if</span>(j != i)&#123;
                p[k].x = op[j].x - op[i].x;
                p[k].y = op[j].y - op[i].y;
                <span class="hljs-keyword">if</span>(color[j])&#123;
                    p[k].x = -p[k].x;
                    p[k].y = -p[k].y;
                &#125;
                p[k].rad = <span class="hljs-built_in">atan2</span>(p[k].y, p[k].x);
                k++;
            &#125;
        sort(p, p+k);
        <span class="hljs-comment">// sweeping. cnt is the number of points whose rad is between p[L] and p[R]</span>
        <span class="hljs-keyword">int</span> L = <span class="hljs-number">0</span>, R = <span class="hljs-number">0</span>, cnt = <span class="hljs-number">2</span>;<span class="hljs-comment">//consider the position of "cnt--"</span>
        <span class="hljs-keyword">while</span>(L &lt; k)&#123;
            <span class="hljs-keyword">if</span>(R == L)&#123;
                R = (R+<span class="hljs-number">1</span>)%k;    <span class="hljs-comment">// empty interval</span>
                cnt++;
            &#125;
            <span class="hljs-keyword">while</span>(R != L &amp;&amp; Left(p[L], p[R]))&#123;
                R = (R+<span class="hljs-number">1</span>)%k;    <span class="hljs-comment">// stop when [L,R] spans across &gt; 180 degrees</span>
                cnt++;
            &#125;
            cnt--;
            L++;
            ans = <span class="hljs-built_in">max</span>(ans, cnt);
        &#125;
    &#125;
    <span class="hljs-keyword">return</span> ans;
&#125;

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>&#123;
    <span class="hljs-keyword">while</span>(<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>,&amp;n)==<span class="hljs-number">1</span>&amp;&amp;n)&#123;
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++)
            <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d%d"</span>, &amp;op[i].x, &amp;op[i].y, &amp;color[i]);
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d\n"</span>, solve());
    &#125;
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
&#125;</code></pre>
<h3 id="l.-七星堆六朝墓群">L. 七星堆六朝墓群<a class="post-anchor" href="#l.-七星堆六朝墓群"></a></h3>
<blockquote>
<p>求最大同色子矩阵，可采用悬线法或单调栈。h[j]代表当前相同值的高度，L[j]代表以h[j]的高度能移动到的最左位置，R[j]代表以h[j]的高度能移动到的最右位置，则当前枚举的等高子矩阵的面积为<span class="math inline">\((R[j]-L[j]+1)*h[j]\)</span>。</p>
</blockquote>
<p>①单调栈</p>
<pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N=<span class="hljs-number">2e3</span>+<span class="hljs-number">10</span>;
<span class="hljs-keyword">typedef</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span> ll;
<span class="hljs-keyword">int</span> n,m,a[N][N],h[N],L[N],R[N];
<span class="hljs-keyword">int</span> stk,q[N];
ll ans;
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>&#123;
    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d"</span>,&amp;n,&amp;m);
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;++i)
    &#123;
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j=<span class="hljs-number">1</span>;j&lt;=m;++j)
        &#123;
            <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>,&amp;a[i][j]);
        &#125;
    &#125;
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;++i)
    &#123;
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j=<span class="hljs-number">1</span>;j&lt;=m;++j)
        &#123;
            <span class="hljs-keyword">if</span>(a[i][j]==a[i<span class="hljs-number">-1</span>][j])h[j]++;
            <span class="hljs-keyword">else</span> h[j]=<span class="hljs-number">1</span>;
        &#125;
        <span class="hljs-keyword">int</span> l,r;
        <span class="hljs-keyword">for</span>(l=<span class="hljs-number">1</span>;l&lt;=n;l=r+<span class="hljs-number">1</span>)
        &#123;
            r=l;
            <span class="hljs-keyword">while</span>(r&lt;=n&amp;&amp;a[i][l]==a[i][r])r++;
            r--;
            stk=<span class="hljs-number">0</span>;
            <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> k=l;k&lt;=r;++k)
            &#123;
                <span class="hljs-keyword">while</span>(stk&amp;&amp;h[q[stk]]&gt;=h[k])stk--;
                <span class="hljs-keyword">if</span>(!stk)L[k]=l;
                <span class="hljs-keyword">else</span> L[k]=q[stk]+<span class="hljs-number">1</span>;
                q[++stk]=k;
             &#125;
             stk=<span class="hljs-number">0</span>;
             <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> k=r;k&gt;=l;--k)
             &#123;
                <span class="hljs-keyword">while</span>(stk&amp;&amp;h[q[stk]]&gt;=h[k])stk--;
                <span class="hljs-keyword">if</span>(!stk)R[k]=r;
                <span class="hljs-keyword">else</span> R[k]=q[stk]<span class="hljs-number">-1</span>;
                q[++stk]=k;
             &#125;
             <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> k=l;k&lt;=r;++k)
             &#123;
                ans=<span class="hljs-built_in">max</span>(ans,<span class="hljs-number">1l</span>l*(R[k]-L[k]+<span class="hljs-number">1</span>)*h[k]*a[i][k]);
             &#125;
        &#125;
    &#125;
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%lld\n"</span>,ans);
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
&#125;</code></pre>
<p>②悬线法</p>
<pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;cstdio&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N=<span class="hljs-number">2e3</span>+<span class="hljs-number">10</span>;
<span class="hljs-keyword">typedef</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span> ll;
<span class="hljs-keyword">int</span> m,n,a[N][N];
<span class="hljs-keyword">int</span> l[N],r[N],h[N];
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>&#123;
    <span class="hljs-keyword">while</span>(~<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d"</span>,&amp;n,&amp;m))
    &#123;
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;++i)
        &#123;
            <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j=<span class="hljs-number">1</span>;j&lt;=m;++j)
            &#123;
                <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>,&amp;a[i][j]);
            &#125;
        &#125;
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j=<span class="hljs-number">1</span>;j&lt;=m;j++)
            l[j]=<span class="hljs-number">0</span>,r[j]=m+<span class="hljs-number">1</span>,h[j]=<span class="hljs-number">0</span>;
        ll ans=<span class="hljs-number">0</span>;
        <span class="hljs-keyword">int</span> la,ra;
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;++i)
        &#123;
            la=<span class="hljs-number">0</span>;ra=m+<span class="hljs-number">1</span>;
            <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j=<span class="hljs-number">1</span>;j&lt;=m;++j)
            &#123;
                <span class="hljs-keyword">if</span>(a[i][j]==a[i<span class="hljs-number">-1</span>][j])
                    h[j]++;
                <span class="hljs-keyword">else</span> 
                    h[j]=<span class="hljs-number">1</span>,l[j]=<span class="hljs-number">0</span>,r[j]=m+<span class="hljs-number">1</span>;
                <span class="hljs-keyword">if</span>(a[i][j]==a[i][j<span class="hljs-number">-1</span>])
                    l[j]=<span class="hljs-built_in">max</span>(l[j],la+<span class="hljs-number">1</span>);
                <span class="hljs-keyword">else</span> 
                    l[j]=j,la=j<span class="hljs-number">-1</span>;
            &#125;
            <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j=m;j&gt;=<span class="hljs-number">1</span>;--j)
            &#123;
                <span class="hljs-keyword">if</span>(a[i][j]==a[i][j+<span class="hljs-number">1</span>])
                    r[j]=<span class="hljs-built_in">min</span>(r[j],ra<span class="hljs-number">-1</span>);
                <span class="hljs-keyword">else</span>
                    r[j]=j,ra=j+<span class="hljs-number">1</span>;
                ans=<span class="hljs-built_in">max</span>(ans,<span class="hljs-number">1l</span>l*h[j]*(r[j]-l[j]+<span class="hljs-number">1</span>)*a[i][j]);
            &#125;
        &#125;
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%lld\n"</span>,ans);
    &#125;
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
&#125;</code></pre>
<h3 id="b.-立方和">B. 立方和<a class="post-anchor" href="#b.-立方和"></a></h3>
<blockquote>
<p>线段树经典题目，hdu4578的弱化版本。 首先考虑加与乘。<br>
用add来表示区间内每个数通过加法操作所增加的值(就是说先加a再乘b再加c之后，这里存的数是a*b+c);<br>
用mult来表示区间内每个数被乘以后的倍数（注意默认应当为1）。 然后再考虑立方和，在这里只解释一下平方和怎么维护，立方和原理类似。（代码中的实现为函数<code>up</code>）<br>
例如，我要把区间<span class="math inline">\([L,R]\)</span>内每个数的值从<span class="math inline">\(x_i\)</span>变为<span class="math inline">\(x_i+p\)</span>的话,那么区间内每个数的变化量为<span class="math inline">\((x_i+p)^2-x_i^2=2x_ip+p^2\)</span>,区间平方和<span class="math inline">\(mk[2]\)</span>的变化量为<span class="math inline">\(2*mk[1]*p+(R-L+1)*p^2\)</span>.那么只需要通过加一个数就可以维护区间平方和了。<br>
需要注意的是，由于这里使用的<span class="math inline">\(mk[1]\)</span>应当是这段区间发生区间加以前的，因而在更新是应该先更新<span class="math inline">\(mk[2]\)</span>再更新<span class="math inline">\(mk[1]\)</span>。</p>
</blockquote>
<pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstdio&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> mod = <span class="hljs-number">1e4</span> + <span class="hljs-number">7</span>;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N = <span class="hljs-number">1e5</span> + <span class="hljs-number">10</span>;
<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">node</span>
&#123;</span>
    <span class="hljs-keyword">int</span> l, r;
    <span class="hljs-keyword">int</span> p[<span class="hljs-number">4</span>];
    <span class="hljs-keyword">int</span> addlazy, multlazy;
&#125; tree[N &lt;&lt; <span class="hljs-number">2</span>];
<span class="hljs-keyword">int</span> a[N];
<span class="hljs-keyword">int</span> mk[<span class="hljs-number">4</span>];
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">up</span><span class="hljs-params">(<span class="hljs-keyword">int</span> pos, <span class="hljs-keyword">int</span> op)</span>
</span>&#123;
    <span class="hljs-keyword">int</span> len = tree[pos].r - tree[pos].l + <span class="hljs-number">1</span>;
    <span class="hljs-keyword">if</span> (op == <span class="hljs-number">3</span>)
    &#123;
        tree[pos].p[<span class="hljs-number">3</span>] += <span class="hljs-number">1l</span>l * mk[<span class="hljs-number">3</span>] * len % mod + <span class="hljs-number">3l</span>l * mk[<span class="hljs-number">2</span>] * tree[pos].p[<span class="hljs-number">1</span>] % mod + <span class="hljs-number">3l</span>l * mk[<span class="hljs-number">1</span>] * tree[pos].p[<span class="hljs-number">2</span>] % mod;
        tree[pos].p[<span class="hljs-number">3</span>] %= mod;
    &#125;
    <span class="hljs-keyword">if</span> (op == <span class="hljs-number">2</span>)
    &#123;
        tree[pos].p[<span class="hljs-number">2</span>] += <span class="hljs-number">1l</span>l * mk[<span class="hljs-number">2</span>] * len % mod + <span class="hljs-number">2l</span>l * mk[<span class="hljs-number">1</span>] * tree[pos].p[<span class="hljs-number">1</span>] % mod;
        tree[pos].p[<span class="hljs-number">2</span>] %= mod;
    &#125;
    <span class="hljs-keyword">if</span> (op == <span class="hljs-number">1</span>)
    &#123;
        tree[pos].p[<span class="hljs-number">1</span>] += <span class="hljs-number">1l</span>l * mk[<span class="hljs-number">1</span>] * len % mod;
        tree[pos].p[<span class="hljs-number">1</span>] %= mod;
    &#125;
&#125;
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">pushdown</span><span class="hljs-params">(<span class="hljs-keyword">int</span> pos)</span>
</span>&#123;
    <span class="hljs-keyword">if</span> (tree[pos].multlazy != <span class="hljs-number">1</span>)
    &#123;
        <span class="hljs-keyword">int</span> w = tree[pos].multlazy;
        mk[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">3</span>; i++)
            mk[i] = <span class="hljs-number">1l</span>l * w * mk[i - <span class="hljs-number">1</span>] % mod;

        tree[pos * <span class="hljs-number">2</span>].multlazy = <span class="hljs-number">1l</span>l * tree[pos * <span class="hljs-number">2</span>].multlazy * mk[<span class="hljs-number">1</span>] % mod;
        tree[pos * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>].multlazy = <span class="hljs-number">1l</span>l * tree[pos * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>].multlazy * mk[<span class="hljs-number">1</span>] % mod;

        tree[pos * <span class="hljs-number">2</span>].addlazy = <span class="hljs-number">1l</span>l * tree[pos * <span class="hljs-number">2</span>].addlazy * mk[<span class="hljs-number">1</span>] % mod;
        tree[pos * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>].addlazy = <span class="hljs-number">1l</span>l * tree[pos * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>].addlazy * mk[<span class="hljs-number">1</span>] % mod;

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">3</span>; i++)
        &#123;
            tree[pos * <span class="hljs-number">2</span>].p[i] = <span class="hljs-number">1l</span>l * tree[pos * <span class="hljs-number">2</span>].p[i] * mk[i] % mod;
            tree[pos * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>].p[i] = <span class="hljs-number">1l</span>l * tree[pos * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>].p[i] * mk[i] % mod;
        &#125;
        tree[pos].multlazy = <span class="hljs-number">1</span>;
    &#125;
    <span class="hljs-keyword">if</span> (tree[pos].addlazy != <span class="hljs-number">0</span>)
    &#123;
        <span class="hljs-keyword">int</span> w = tree[pos].addlazy;

        mk[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">3</span>; i++)
            mk[i] = <span class="hljs-number">1l</span>l * w * mk[i - <span class="hljs-number">1</span>] % mod;

        tree[pos * <span class="hljs-number">2</span>].addlazy += w, tree[pos * <span class="hljs-number">2</span>].addlazy %= mod;
        tree[pos * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>].addlazy += w, tree[pos * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>].addlazy %= mod;
        up(pos * <span class="hljs-number">2</span>, <span class="hljs-number">3</span>);
        up(pos * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>, <span class="hljs-number">3</span>);
        up(pos * <span class="hljs-number">2</span>, <span class="hljs-number">2</span>);
        up(pos * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>, <span class="hljs-number">2</span>);
        up(pos * <span class="hljs-number">2</span>, <span class="hljs-number">1</span>);
        up(pos * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
        tree[pos].addlazy = <span class="hljs-number">0</span>;
    &#125;
&#125;
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">pushup</span><span class="hljs-params">(<span class="hljs-keyword">int</span> pos)</span>
</span>&#123;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">3</span>; i++)
        tree[pos].p[i] = (tree[pos * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>].p[i] + tree[pos * <span class="hljs-number">2</span>].p[i]) % mod;
&#125;
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">build</span><span class="hljs-params">(<span class="hljs-keyword">int</span> pos, <span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> r)</span>
</span>&#123;
    tree[pos].l = l;
    tree[pos].r = r;
    tree[pos].multlazy = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">if</span> (l == r)
    &#123;
        tree[pos].p[<span class="hljs-number">1</span>] = a[l] % mod;
        tree[pos].p[<span class="hljs-number">2</span>] = a[l] * a[l] % mod;
        tree[pos].p[<span class="hljs-number">3</span>] = <span class="hljs-number">1l</span>l * a[l] * a[l] * a[l] % mod;
        <span class="hljs-keyword">return</span>;
    &#125;
    <span class="hljs-keyword">int</span> mid = (tree[pos].l + tree[pos].r) &gt;&gt; <span class="hljs-number">1</span>;
    build(pos * <span class="hljs-number">2</span>, l, mid);
    build(pos * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>, mid + <span class="hljs-number">1</span>, r);
    pushup(pos);
&#125;
<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">update</span><span class="hljs-params">(<span class="hljs-keyword">int</span> pos, <span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> r, <span class="hljs-keyword">int</span> w, <span class="hljs-keyword">int</span> op)</span>
</span>&#123;
    <span class="hljs-keyword">if</span> (l &lt;= tree[pos].l &amp;&amp; tree[pos].r &lt;= r)
    &#123;
        mk[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">3</span>; i++)
            mk[i] = <span class="hljs-number">1l</span>l * w * mk[i - <span class="hljs-number">1</span>] % mod;
        <span class="hljs-keyword">if</span> (op == <span class="hljs-number">1</span>)
        &#123;
            tree[pos].addlazy += w;
            tree[pos].addlazy %= mod;
            up(pos, <span class="hljs-number">3</span>);
            up(pos, <span class="hljs-number">2</span>);
            up(pos, <span class="hljs-number">1</span>);
        &#125;
        <span class="hljs-keyword">else</span>
        &#123;
            tree[pos].multlazy = <span class="hljs-number">1l</span>l * w * tree[pos].multlazy % mod;
            tree[pos].addlazy = <span class="hljs-number">1l</span>l * w * tree[pos].addlazy % mod;
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">3</span>; i++)
                tree[pos].p[i] = <span class="hljs-number">1l</span>l * tree[pos].p[i] * mk[i] % mod;
        &#125;
        <span class="hljs-keyword">return</span>;
    &#125;
    pushdown(pos);
    <span class="hljs-keyword">int</span> mid = (tree[pos].l + tree[pos].r) &gt;&gt; <span class="hljs-number">1</span>;
    <span class="hljs-keyword">if</span> (l &lt;= mid)
        update(pos * <span class="hljs-number">2</span>, l, r, w, op);
    <span class="hljs-keyword">if</span> (r &gt; mid)
        update(pos * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>, l, r, w, op);
    pushup(pos);
&#125;
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">quary</span><span class="hljs-params">(<span class="hljs-keyword">int</span> pos, <span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> r)</span>
</span>&#123;
    <span class="hljs-keyword">if</span> (l &lt;= tree[pos].l &amp;&amp; tree[pos].r &lt;= r)
    &#123;
        <span class="hljs-keyword">return</span> tree[pos].p[<span class="hljs-number">3</span>] % mod;
    &#125;
    pushdown(pos);
    <span class="hljs-keyword">int</span> mid = (tree[pos].l + tree[pos].r) &gt;&gt; <span class="hljs-number">1</span>;
    <span class="hljs-keyword">int</span> res = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">if</span> (l &lt;= mid)
        res += quary(pos * <span class="hljs-number">2</span>, l, r);
    res %= mod;
    <span class="hljs-keyword">if</span> (r &gt; mid)
        res += quary(pos * <span class="hljs-number">2</span> + <span class="hljs-number">1</span>, l, r);
    <span class="hljs-keyword">return</span> res % mod;
&#125;
<span class="hljs-keyword">int</span> n, m;
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>&#123;
<span class="hljs-meta">#<span class="hljs-meta-keyword">ifdef</span> ONLINE_JUDGE</span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span>
    freopen(<span class="hljs-string">"r.txt"</span>, <span class="hljs-string">"r"</span>, <span class="hljs-built_in">stdin</span>);
<span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span>
    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d"</span>, &amp;n, &amp;m);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; i++)
        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;a[i]);
    build(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, n);
    <span class="hljs-comment">//cout&lt;&lt;tree[1].p[1]&lt;&lt;endl;</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= m; i++)
    &#123;
        <span class="hljs-keyword">int</span> ff, x, y, w;
        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d%d"</span>, &amp;ff, &amp;x, &amp;y);
        <span class="hljs-keyword">if</span> (ff == <span class="hljs-number">1</span>)
        &#123;
            <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;w);
            update(<span class="hljs-number">1</span>, x, y, w, <span class="hljs-number">1</span>);
        &#125;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ff == <span class="hljs-number">2</span>)
        &#123;
            <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;w);
            update(<span class="hljs-number">1</span>, x, y, w, <span class="hljs-number">2</span>);
        &#125;
        <span class="hljs-keyword">else</span>
        &#123;
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d\n"</span>, quary(<span class="hljs-number">1</span>, x, y));
        &#125;
    &#125;
&#125;</code></pre>
<h3 id="g.-牙签自动机">G. 牙签自动机<a class="post-anchor" href="#g.-牙签自动机"></a></h3>
<blockquote>
<p>①暴力<br>
把一根木棍分为4等分，然后在1/4与3/4的位置做标记，表示这里有一根木棍。然后每次判断标记点的边上能不能放一根木棍。奇数轮，只能横着摆；偶数轮，只能竖着摆。比如在判断<span class="math inline">\([i,j]\)</span>点的左侧能不能摆棒子的时候，判断<span class="math inline">\([i-1,j-1],[i-1,j+1],[i-2,j]\)</span>是否被标记（多判一个点的原因是，注意第三轮，两根横棒中间没有生成竖棒），如果都没有，那么可以在<span class="math inline">\([i-1,j-2]\)</span>~<span class="math inline">\([i-1,j+2]\)</span>间摆一根棒子，并标记<span class="math inline">\([i-1,j-1],[i-1,j+1]\)</span>.<br>
例如，开始的一根摆在了<span class="math inline">\([1998,2000]\)</span>~<span class="math inline">\([2002,2000]\)</span>，然后标记<span class="math inline">\([1999,2000],[2001,2000]\)</span>,判断<span class="math inline">\([1998,1999],[1998,2001],[1997,2000]\)</span>都没有被标记，那么可以在左边放竖棒，并标记<span class="math inline">\([1998,1999],[1998,2001]\)</span>. 程序中使用了队列来确定这到底是第几轮。</p>
</blockquote>
<pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;

<span class="hljs-keyword">int</span> ans[<span class="hljs-number">1050</span>],mp[<span class="hljs-number">4000</span>][<span class="hljs-number">4000</span>];
<span class="hljs-built_in">queue</span>&lt;pair&lt;<span class="hljs-keyword">int</span>,<span class="hljs-keyword">int</span>&gt; &gt; q;

<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">int</span> <span class="hljs-title">read</span><span class="hljs-params">()</span></span>&#123;
    <span class="hljs-keyword">int</span> x=<span class="hljs-number">0</span>,f=<span class="hljs-number">1</span>;
    <span class="hljs-keyword">char</span> ch=getchar();
    <span class="hljs-keyword">while</span>(ch&lt;<span class="hljs-string">'0'</span>||ch&gt;<span class="hljs-string">'9'</span>)&#123;
        <span class="hljs-keyword">if</span>(ch==<span class="hljs-string">'-'</span>) f=<span class="hljs-number">-1</span>;
        ch=getchar();
    &#125;
    <span class="hljs-keyword">while</span>(ch&gt;=<span class="hljs-string">'0'</span>&amp;&amp;ch&lt;=<span class="hljs-string">'9'</span>)&#123;
        x=(x&lt;&lt;<span class="hljs-number">1</span>)+(x&lt;&lt;<span class="hljs-number">3</span>)+(ch^<span class="hljs-number">48</span>);
        ch=getchar();
    &#125;
    <span class="hljs-keyword">return</span> x;
&#125;

<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span>
</span>&#123;
    <span class="hljs-keyword">int</span> p=<span class="hljs-number">0</span>,num=<span class="hljs-number">1</span>,tot=<span class="hljs-number">1</span>;
    ans[<span class="hljs-number">1</span>]=<span class="hljs-number">1</span>;
    mp[<span class="hljs-number">1999</span>][<span class="hljs-number">2000</span>]=<span class="hljs-number">1</span>;
    mp[<span class="hljs-number">2001</span>][<span class="hljs-number">2000</span>]=<span class="hljs-number">1</span>;
    q.push(make_pair&lt;<span class="hljs-keyword">int</span>,<span class="hljs-keyword">int</span>&gt;(<span class="hljs-number">1999</span>,<span class="hljs-number">2000</span>));
    q.push(make_pair&lt;<span class="hljs-keyword">int</span>,<span class="hljs-keyword">int</span>&gt;(<span class="hljs-number">2001</span>,<span class="hljs-number">2000</span>));
    q.push(make_pair&lt;<span class="hljs-keyword">int</span>,<span class="hljs-keyword">int</span>&gt;(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>));
    <span class="hljs-keyword">while</span>(num&lt;<span class="hljs-number">1030</span>)
    &#123;
        ++num;
        <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)
        &#123;
            <span class="hljs-keyword">int</span> le=q.front().first,ri=q.front().second;
            q.pop();
            <span class="hljs-keyword">if</span>(le==<span class="hljs-number">0</span>&amp;&amp;ri==<span class="hljs-number">0</span>) <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">if</span>(!p&amp;&amp;!mp[le<span class="hljs-number">-1</span>][ri<span class="hljs-number">-1</span>]&amp;&amp;!mp[le<span class="hljs-number">-1</span>][ri+<span class="hljs-number">1</span>]&amp;&amp;!mp[le<span class="hljs-number">-2</span>][ri])
            &#123;
                ++tot; 
                mp[le<span class="hljs-number">-1</span>][ri<span class="hljs-number">-1</span>]=mp[le<span class="hljs-number">-1</span>][ri+<span class="hljs-number">1</span>]=<span class="hljs-number">1</span>;
                q.push(make_pair&lt;<span class="hljs-keyword">int</span>,<span class="hljs-keyword">int</span>&gt;(le<span class="hljs-number">-1</span>,ri<span class="hljs-number">-1</span>));
                q.push(make_pair&lt;<span class="hljs-keyword">int</span>,<span class="hljs-keyword">int</span>&gt;(le<span class="hljs-number">-1</span>,ri+<span class="hljs-number">1</span>));
                <span class="hljs-keyword">continue</span>;
            &#125;
            <span class="hljs-keyword">if</span>(!p&amp;&amp;!mp[le+<span class="hljs-number">1</span>][ri<span class="hljs-number">-1</span>]&amp;&amp;!mp[le+<span class="hljs-number">1</span>][ri+<span class="hljs-number">1</span>]&amp;&amp;!mp[le+<span class="hljs-number">2</span>][ri])
            &#123;
                ++tot;
                mp[le+<span class="hljs-number">1</span>][ri<span class="hljs-number">-1</span>]=mp[le+<span class="hljs-number">1</span>][ri+<span class="hljs-number">1</span>]=<span class="hljs-number">1</span>;
                q.push(make_pair&lt;<span class="hljs-keyword">int</span>,<span class="hljs-keyword">int</span>&gt;(le+<span class="hljs-number">1</span>,ri<span class="hljs-number">-1</span>));
                q.push(make_pair&lt;<span class="hljs-keyword">int</span>,<span class="hljs-keyword">int</span>&gt;(le+<span class="hljs-number">1</span>,ri+<span class="hljs-number">1</span>));
                <span class="hljs-keyword">continue</span>;
            &#125;
            <span class="hljs-keyword">if</span>(p&amp;&amp;!mp[le<span class="hljs-number">-1</span>][ri<span class="hljs-number">-1</span>]&amp;&amp;!mp[le+<span class="hljs-number">1</span>][ri<span class="hljs-number">-1</span>]&amp;&amp;!mp[le][ri<span class="hljs-number">-2</span>])
            &#123;
                ++tot; 
                mp[le<span class="hljs-number">-1</span>][ri<span class="hljs-number">-1</span>]=mp[le+<span class="hljs-number">1</span>][ri<span class="hljs-number">-1</span>]=<span class="hljs-number">1</span>;
                q.push(make_pair&lt;<span class="hljs-keyword">int</span>,<span class="hljs-keyword">int</span>&gt;(le<span class="hljs-number">-1</span>,ri<span class="hljs-number">-1</span>));
                q.push(make_pair&lt;<span class="hljs-keyword">int</span>,<span class="hljs-keyword">int</span>&gt;(le+<span class="hljs-number">1</span>,ri<span class="hljs-number">-1</span>));
                <span class="hljs-keyword">continue</span>;
            &#125;
            <span class="hljs-keyword">if</span>(p&amp;&amp;!mp[le<span class="hljs-number">-1</span>][ri+<span class="hljs-number">1</span>]&amp;&amp;!mp[le+<span class="hljs-number">1</span>][ri+<span class="hljs-number">1</span>]&amp;&amp;!mp[le][ri+<span class="hljs-number">2</span>])
            &#123;
                ++tot;
                mp[le<span class="hljs-number">-1</span>][ri+<span class="hljs-number">1</span>]=mp[le+<span class="hljs-number">1</span>][ri+<span class="hljs-number">1</span>]=<span class="hljs-number">1</span>;
                q.push(make_pair&lt;<span class="hljs-keyword">int</span>,<span class="hljs-keyword">int</span>&gt;(le<span class="hljs-number">-1</span>,ri+<span class="hljs-number">1</span>));
                q.push(make_pair&lt;<span class="hljs-keyword">int</span>,<span class="hljs-keyword">int</span>&gt;(le+<span class="hljs-number">1</span>,ri+<span class="hljs-number">1</span>));
                <span class="hljs-keyword">continue</span>;
            &#125;
        &#125;
        ans[num]=tot;
        q.push(make_pair&lt;<span class="hljs-keyword">int</span>,<span class="hljs-keyword">int</span>&gt;(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>));
        p^=<span class="hljs-number">1</span>;
    &#125;
&#125;

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;
    init();
    <span class="hljs-keyword">int</span> n=<span class="hljs-built_in">read</span>();
    <span class="hljs-keyword">while</span>(n--)
    &#123;
        <span class="hljs-keyword">int</span> now=<span class="hljs-built_in">read</span>();
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d%c"</span>,ans[now],n?<span class="hljs-string">' '</span>:<span class="hljs-string">'\n'</span>);
    &#125;
&#125;</code></pre>
<blockquote>
<p>②本地模拟直接交打表后的值<br>
将打表后的值放入mp[1030]，每次直接查询mp[i].代码仅11MB</p>
</blockquote>
<blockquote>
<p>③找规律<br>
我们针对每个图形的右上角进行分析可以发现：每一次非2的次方的数字时，右上角模块总可以被划分成三个部分，即sto[m]*2和sto[m+1]；同时，每一次为2的次方的时候，整个图形为一个外边封闭近似正方形，其内部为<span class="math inline">\(2^{2*k+1}+1\)</span>个牙签。<br>
因此，图形的表达式为： <span class="math display">\[\left\{\begin{matrix}
n=2^k &amp; sto[n] = 2^{(2k+1)}/3\\
n\neq 2^k &amp; sto[n] = 2^{k} + sto[n - 2^{k}] * 2 + sto[n - 2^{k}+1] -1
\end{matrix}\right.\]</span></p>
</blockquote>
<pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstdio&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cmath&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;

<span class="hljs-keyword">typedef</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span> ll;

ll sto[<span class="hljs-number">1025</span>], base[<span class="hljs-number">35</span>] = &#123;<span class="hljs-number">1l</span>l&#125;;

<span class="hljs-function"><span class="hljs-keyword">inline</span> ll <span class="hljs-title">read</span><span class="hljs-params">()</span>
</span>&#123;
    ll X = <span class="hljs-number">0</span>, w = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">char</span> ch = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">while</span> (!<span class="hljs-built_in">isdigit</span>(ch))
    &#123;
        w |= ch == <span class="hljs-string">'-'</span>;
        ch = getchar();
    &#125;
    <span class="hljs-keyword">while</span> (<span class="hljs-built_in">isdigit</span>(ch))
        X = (X &lt;&lt; <span class="hljs-number">3</span>) + (X &lt;&lt; <span class="hljs-number">1</span>) + (ch ^ <span class="hljs-number">48</span>), ch = getchar();
    <span class="hljs-keyword">return</span> w ? -X : X;
&#125;

<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> <span class="hljs-title">write</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span>
</span>&#123;
    <span class="hljs-keyword">if</span> (x &lt; <span class="hljs-number">0</span>)
        <span class="hljs-built_in">putchar</span>(<span class="hljs-string">'-'</span>), x = -x;
    <span class="hljs-keyword">if</span> (x &gt; <span class="hljs-number">9</span>)
        <span class="hljs-built_in">write</span>(x / <span class="hljs-number">10</span>);
    <span class="hljs-built_in">putchar</span>(x % <span class="hljs-number">10</span> + <span class="hljs-string">'0'</span>);
&#125;

<span class="hljs-function"><span class="hljs-keyword">inline</span> <span class="hljs-keyword">void</span> <span class="hljs-title">writesp</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span>
</span>&#123;
    <span class="hljs-built_in">write</span>(x);
    <span class="hljs-built_in">putchar</span>(<span class="hljs-string">' '</span>);
&#125;

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>
</span>&#123;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">30</span>; i++)
        base[i] = base[i - <span class="hljs-number">1</span>] &lt;&lt; <span class="hljs-number">1l</span>l;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">1024</span>; i++)
    &#123;
        <span class="hljs-keyword">int</span> k = lower_bound(base, base + <span class="hljs-number">15</span>, i) - base;
        <span class="hljs-keyword">if</span> (base[k] == i)
            sto[i] = (base[<span class="hljs-number">2</span> * k + <span class="hljs-number">1</span>] + <span class="hljs-number">1</span>) / <span class="hljs-number">3</span>;
        <span class="hljs-keyword">else</span>
        &#123;
            k--;
            <span class="hljs-keyword">int</span> m = i - base[k];
            sto[i] = sto[base[k]] + <span class="hljs-number">2l</span>l * sto[m] + sto[m + <span class="hljs-number">1</span>] - <span class="hljs-number">1l</span>l;
        &#125;
    &#125;
    sto[<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">int</span> T = <span class="hljs-built_in">read</span>();
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; T; i++)
    &#123;
        <span class="hljs-keyword">if</span> (i)
            <span class="hljs-built_in">putchar</span>(<span class="hljs-string">' '</span>);
        <span class="hljs-built_in">write</span>(sto[<span class="hljs-built_in">read</span>()]);
    &#125;
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
&#125;</code></pre>
<h3 id="e.-膜法项链-easy-version">E. 膜法项链 Easy Version<a class="post-anchor" href="#e.-膜法项链-easy-version"></a></h3>
<blockquote>
<p><span class="math inline">\(n\leq2000\)</span><br>
从0到n-1枚举第二种操作的使用次数step，<br>
那么对于最终得到的编号为i的珍珠，<br>
假如它是召放在j位置然后右移多次得到的，<br>
则一定有 <span class="math inline">\(i-step\leq j \leq i\)</span> ，<br>
并且这是充要的，即它可以由这个区间的任何一个j生成后右移多次得到。<br>
因此只用这个区间的a[j]的最小值就是得到i的代价。<br>
把所有i的代价相加再加上step*x就是step对应的最小代价。<br>
注意，这个题目是一个环而不是链，这只需要将a复制一份即可。<br>
求区间最小值有很多方法，比如单调队列。<br>
时间复杂度 <span class="math inline">\(O(n^2)\)</span><br>
<a href="http://10.8.128.203:7217/problem.php?id=1344" target="_blank" rel="noopener">戳我补题</a></p>
</blockquote>
<h3 id="e.-膜法项链-hard-version">E. 膜法项链 Hard Version<a class="post-anchor" href="#e.-膜法项链-hard-version"></a></h3>
<blockquote>
<p>时间复杂度<span class="math inline">\(O(n)\)</span></p>
</blockquote>
<pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;
<span class="hljs-keyword">int</span> n;<span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span> w;
<span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span> d[<span class="hljs-number">2000100</span>];
<span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span> a[<span class="hljs-number">2000100</span>];
<span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span> st[<span class="hljs-number">2000200</span>];
<span class="hljs-keyword">int</span>  num[<span class="hljs-number">2000200</span>];
<span class="hljs-keyword">int</span> se=<span class="hljs-number">0</span>;
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;
    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%lld"</span>,&amp;n,&amp;w);
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;n;i++)&#123;
        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%lld"</span>,&amp;a[i]);
        a[i+n]=a[i];
    &#125;
    a[<span class="hljs-number">2</span>*n]=<span class="hljs-number">-1</span>;
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;=<span class="hljs-number">2</span>*n;i++)&#123;
        <span class="hljs-keyword">if</span>(se==<span class="hljs-number">0</span>||st[se<span class="hljs-number">-1</span>]&lt;=a[i])&#123;
            st[se]=a[i];
            num[se]=i;
            se++;
        &#125;
        <span class="hljs-keyword">else</span>&#123;
            <span class="hljs-keyword">while</span>(se&amp;&amp;st[se<span class="hljs-number">-1</span>]&gt;a[i])&#123;
                <span class="hljs-keyword">if</span>(i&gt;n)&#123;
                    <span class="hljs-keyword">int</span> d2begin=<span class="hljs-built_in">max</span>(num[se<span class="hljs-number">-1</span>],n);
                    <span class="hljs-keyword">int</span> d2len=i-d2begin;
                    <span class="hljs-keyword">int</span> dbegin;<span class="hljs-keyword">int</span> dlen;
                    <span class="hljs-keyword">if</span>(se==<span class="hljs-number">1</span>)&#123;
                        dbegin=<span class="hljs-number">0</span>;
                    &#125;
                    <span class="hljs-keyword">else</span>&#123;
                        dbegin=num[se<span class="hljs-number">-2</span>];
                    &#125;
                    dlen=num[se<span class="hljs-number">-1</span>]-dbegin;
                    d[d2begin-num[se<span class="hljs-number">-1</span>]]+=st[se<span class="hljs-number">-1</span>];d[d2begin-num[se<span class="hljs-number">-1</span>]+d2len]-=st[se<span class="hljs-number">-1</span>];
                    d[d2begin-num[se<span class="hljs-number">-1</span>]+dlen]-=st[se<span class="hljs-number">-1</span>];d[d2begin-num[se<span class="hljs-number">-1</span>]+dlen+d2len]+=st[se<span class="hljs-number">-1</span>];
                &#125;
                se--;
            &#125;
            st[se]=a[i];
            num[se]=i;
            se++;
        &#125;
    &#125;
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">1</span>;i&lt;=<span class="hljs-number">2</span>*n;i++)&#123;
        d[i]=d[i<span class="hljs-number">-1</span>]+d[i];
    &#125;
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">1</span>;i&lt;=<span class="hljs-number">2</span>*n;i++)&#123;
        d[i]=d[i<span class="hljs-number">-1</span>]+d[i];
    &#125;
    <span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span> ans=<span class="hljs-number">0x3f3f3f3f3f3f3f3f</span>;
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;n;i++)&#123;
        ans=<span class="hljs-built_in">min</span>(ans,i*w+d[i]);
    &#125;
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%lld\n"</span>,ans);
&#125;</code></pre>
<h3 id="j.-更强的未来道具fg-c193-easy-version">J. 更强的未来道具FG-C193 Easy Version<a class="post-anchor" href="#j.-更强的未来道具fg-c193-easy-version"></a></h3>
<p>以每个为止判断每个对称轴会对称到哪一个位置。最后查看所有位置是否相同。<br>
复杂度<span class="math inline">\(O(n^2)\)</span><br>
<a href="http://10.8.128.203:7217/problem.php?id=1286" target="_blank" rel="noopener">戳我补题</a></p>
<h3 id="j.-更强的未来道具fg-c193-hard-version">J. 更强的未来道具FG-C193 Hard Version<a class="post-anchor" href="#j.-更强的未来道具fg-c193-hard-version"></a></h3>
<blockquote>
<p>像manacher一样两字符中间补一个字符。然后对manacher判断的位置进行判断，不过把判断两字符是否相同改为将带权并查集合并。 复杂度<span class="math inline">\(O(n)\)</span></p>
</blockquote>
<pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;
<span class="hljs-keyword">int</span> a[<span class="hljs-number">200040</span>];
<span class="hljs-keyword">int</span> abc[<span class="hljs-number">220000</span>];
<span class="hljs-keyword">int</span> abcpos[<span class="hljs-number">220000</span>];
<span class="hljs-keyword">int</span> fa[<span class="hljs-number">200040</span>];
<span class="hljs-keyword">int</span> ans[<span class="hljs-number">200040</span>];
<span class="hljs-keyword">int</span> unans[<span class="hljs-number">200020</span>];
<span class="hljs-keyword">int</span> aans[<span class="hljs-number">100020</span>];

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">find</span><span class="hljs-params">(<span class="hljs-keyword">int</span> i)</span></span>&#123;
    <span class="hljs-keyword">if</span>(fa[i]!=i)&#123;
        fa[i]=<span class="hljs-built_in">find</span>(fa[i]);
        ans[i]=ans[fa[i]];
        <span class="hljs-keyword">return</span> fa[i];
    &#125;
    <span class="hljs-keyword">return</span> fa[i];
&#125;
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;
    <span class="hljs-keyword">int</span> n;
    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>,&amp;n);
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">2</span>*n;i++)&#123;
        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>,&amp;a[i]);
        a[i]*=<span class="hljs-number">2</span>;
    &#125;
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;=<span class="hljs-number">2</span>*n;i++)&#123;
    fa[i]=i;
    &#125;
    <span class="hljs-keyword">int</span> m;
    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>,&amp;m);
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">1</span>;i&lt;=m;i++)&#123;
        <span class="hljs-keyword">int</span> tmp;
        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>,&amp;tmp);
        <span class="hljs-keyword">char</span> tchar;
        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">" %c"</span>,&amp;tchar);
        <span class="hljs-keyword">if</span>(aans[tmp]&amp;&amp;aans[tmp]!=tchar)&#123;
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"-1\n"</span>);<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
        &#125;  
        aans[tmp]=tchar;
        <span class="hljs-keyword">if</span>(abc[tchar]!=<span class="hljs-number">0</span>)&#123;
        <span class="hljs-built_in">find</span>(<span class="hljs-number">2</span>*tmp);
        <span class="hljs-built_in">find</span>(abcpos[tchar]);
            fa[<span class="hljs-built_in">find</span>(<span class="hljs-number">2</span>*tmp)]=<span class="hljs-built_in">find</span>(abcpos[tchar]);
        &#125;
        ans[<span class="hljs-number">2</span>*tmp]=tchar;
        abc[tchar]++;abcpos[tchar]=tmp*<span class="hljs-number">2</span>;
    &#125;
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)&#123;
        fa[i*<span class="hljs-number">2</span><span class="hljs-number">-1</span>]=<span class="hljs-number">1</span>;
        ans[i*<span class="hljs-number">2</span><span class="hljs-number">-1</span>]=<span class="hljs-number">257</span>;
    &#125;
    <span class="hljs-keyword">int</span> nowmax=<span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">2</span>*n;i++)&#123;
        <span class="hljs-keyword">while</span>(nowmax&lt;=a[i]+i<span class="hljs-number">-1</span>)&#123;
            <span class="hljs-keyword">if</span>(nowmax&lt;<span class="hljs-number">2</span>*n&amp;&amp;(i-nowmax+i)&gt;=<span class="hljs-number">0</span>)&#123;
                <span class="hljs-keyword">if</span>(<span class="hljs-built_in">find</span>(i-nowmax+i)!=<span class="hljs-built_in">find</span>(nowmax))&#123;
                    <span class="hljs-keyword">if</span>(ans[<span class="hljs-built_in">find</span>(i-nowmax+i)]&amp;&amp;ans[<span class="hljs-built_in">find</span>(nowmax)]&amp;&amp;ans[<span class="hljs-built_in">find</span>(i-nowmax+i)]!=ans[<span class="hljs-built_in">find</span>(nowmax)])&#123;
                    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"-1\n"</span>); <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
                    &#125;
                    <span class="hljs-keyword">else</span>&#123;
                <span class="hljs-keyword">if</span>(ans[<span class="hljs-built_in">find</span>(nowmax)]==<span class="hljs-number">0</span>) &#123;
                    fa[<span class="hljs-built_in">find</span>(nowmax)]=<span class="hljs-built_in">find</span>(i-nowmax+i);<span class="hljs-built_in">find</span>(nowmax);
                &#125;
                <span class="hljs-keyword">else</span>&#123;
                fa[<span class="hljs-built_in">find</span>(i-nowmax+i)]=<span class="hljs-built_in">find</span>(nowmax);  
                <span class="hljs-built_in">find</span>(i-nowmax+i);
                &#125;
                    &#125;
                &#125;
            &#125;
            nowmax++;
        &#125;
    &#125;
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">2</span>*n;i++)&#123;
        <span class="hljs-keyword">if</span>(i+a[i]&lt;<span class="hljs-number">2</span>*n&amp;&amp;i-a[i]&gt;=<span class="hljs-number">0</span>&amp;&amp;(i-a[i])%<span class="hljs-number">2</span>==<span class="hljs-number">0</span>)&#123;
            <span class="hljs-keyword">if</span>(<span class="hljs-built_in">find</span>(i-a[i])==<span class="hljs-built_in">find</span>(i+a[i]))&#123;
                    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"-1\n"</span>); <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
            &#125;
        &#125;
        <span class="hljs-keyword">if</span>(i+a[i]+<span class="hljs-number">1</span>&lt;<span class="hljs-number">2</span>*n&amp;&amp;i-a[i]<span class="hljs-number">-1</span>&gt;=<span class="hljs-number">0</span>&amp;&amp;(i-a[i])%<span class="hljs-number">2</span>!=<span class="hljs-number">0</span>)&#123;
            <span class="hljs-keyword">if</span>(<span class="hljs-built_in">find</span>(i-a[i]<span class="hljs-number">-1</span>)==<span class="hljs-built_in">find</span>(i+a[i]+<span class="hljs-number">1</span>))&#123;
                    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"-1\n"</span>); <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
            &#125;
        &#125;
    &#125;
    <span class="hljs-keyword">int</span> unknow=<span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;n;i++)&#123;
        <span class="hljs-keyword">if</span>(ans[<span class="hljs-built_in">find</span>(<span class="hljs-number">2</span>*i)]==<span class="hljs-number">0</span>)&#123;
            unans[unknow]=i;
            unknow++;
        &#125;
    &#125;
    <span class="hljs-keyword">if</span>(unknow)&#123;
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;unknow;i++)&#123;
            <span class="hljs-keyword">if</span>(i!=<span class="hljs-number">0</span>) <span class="hljs-built_in">printf</span>(<span class="hljs-string">" "</span>);
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d"</span>,unans[i]);
        &#125;
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"\n"</span>);
    &#125;
    <span class="hljs-keyword">else</span>&#123;
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;n;i++)&#123;
            <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%c"</span>,ans[<span class="hljs-built_in">find</span>(<span class="hljs-number">2</span>*i)]);
        &#125;
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"\n"</span>);
    &#125;
&#125;</code></pre>


  
    <div class="post-reward">
    <div id="reward-button">打赏</div>
      <div id="qr">
        <div class="wrap">
            
            <div class="bg-wrap">
              <a href="/images/zhifubao.png" target="_block" class="bg" style="background-image:url('/images/zhifubao.png')"></a>
              支付宝
            </div>
            
            
            <div class="bg-wrap">
                <a href="/images/weixin.png" target="_block" class="bg" style="background-image:url('/images/weixin.png')"></a>
              微信
            </div>
            
        </div>
      </div>
    </div>
  
  <div class="post-guide">
    <div class="item left">
        
          <a href="/2019/12/19/CF1272F/">CF1272F</a>
        
    </div>
    <div class="item right">
        
          <a href="/2019/12/10/P3128/">P3128</a>
        
    </div>
  </div>

  

  <div class="post-copyright">
    <div class="auth">
      本文作者：<a href="/">sher-wu</a>
    </div>
    <div class="link">
      永久链接：<a href="/2019/12/11/%E5%8D%8E%E4%B8%BA%E6%9D%AF-%E5%A4%A7%E8%BF%9E%E7%90%86%E5%B7%A5%E5%A4%A7%E5%AD%A6%E7%AC%AC12%E5%B1%8A%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E5%A4%A7%E8%B5%9B%E9%A2%98%E8%A7%A3/">http://sher-wu.github.io/2019/12/11/%E5%8D%8E%E4%B8%BA%E6%9D%AF-%E5%A4%A7%E8%BF%9E%E7%90%86%E5%B7%A5%E5%A4%A7%E5%AD%A6%E7%AC%AC12%E5%B1%8A%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E5%A4%A7%E8%B5%9B%E9%A2%98%E8%A7%A3/</a>
    </div>
    <div class="declare">
      版权声明：本文首发于<a href="/">sher-wu</a>的博客，转载请注明出处！
    </div>
  </div>

  <div id="comment"></div>

  
  
</article>
        <footer>
          <div class="copyright">
            ©2019
            <a href="http://sher-wu.github.io">sher-wu</a> Powered by <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> |
            <a href="https://github.com/shixiaohu2206/hexo-theme-huhu" target="_blank" rel="noopener">hexo-theme-huhu</a>
          </div>
          
        </footer>
      </div>
    </div>
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</body>
  
</html>
<script type="text/javascript">
                  window.HUHU_CONFIG = JSON.parse("{\"share\":[\"weibo\",\"weixin\",\"qqkongjian\",\"QQ\",\"douban\",\"facebook\",\"twitter\",\"google\"],\"service_worker\":{\"open\":false},\"baidu_tongji\":{\"site_from\":\"2019/11/11\",\"site_id\":\"\",\"access_token\":\"21.434ad27effea7b2f85bd99ab37c48765.2592000.1578677609.2685265557-18003697\"}}")
                </script> <script type="text/javascript">window.addEventListener('load', function() {
    
    window.loadJs = function(d, m, a) {
      var c = document.getElementsByTagName('head')[0] || document.head || document.documentElement
      var b = document.createElement('script')
      b.defer = true
      b.setAttribute('type', 'text/javascript')
      b.setAttribute('charset', 'UTF-8')
      b.setAttribute('async', 'true')
      b.setAttribute('src', d)
      m && b.setAttribute('data-main', '/scripts/app-built')
      if (typeof a === 'function') {
        if (window.attachEvent) {
          b.onreadystatechange = function() {
            var e = b.readyState
            if (e === 'loaded' || e === 'complete') {
              b.onreadystatechange = null
              a()
            }
          }
        } else {
          b.onload = a
        }
      }
      c.appendChild(b)
    }
    window.loadJs && window.loadJs('https://cdn.bootcss.com/require.js/2.3.6/require.min.js', true, function() {require.config({"paths":{"util":"util","share":"share","search":"search","registerSW":"registerSW","valine":"cdn/Valine.min","av":["https://cdn.jsdelivr.net/npm/leancloud-storage/dist/av-min"],"pjax":["https://cdn.bootcss.com/jquery.pjax/2.0.1/jquery.pjax.min"],"jquery":["https://cdn.bootcss.com/jquery/3.4.1/jquery.min"],"confirm":["https://cdn.bootcss.com/jquery-confirm/3.3.4/jquery-confirm.min"],"fancybox":["https://cdn.bootcss.com/fancybox/3.5.7/jquery.fancybox.min"],"chart":["https://cdn.bootcss.com/Chart.js/2.8.0-rc.1/Chart.bundle.min"]},"map":{"*":{"css":"https://cdn.bootcss.com/require-css/0.1.10/css.min.js"}},"shim":{"fancybox":{"deps":["css!https://cdn.bootcss.com/fancybox/3.5.7/jquery.fancybox.min.css"]},"confirm":{"deps":["css!https://cdn.bootcss.com/jquery-confirm/3.3.4/jquery-confirm.min.css"]},"chart":{"deps":["css!https://cdn.bootcss.com/Chart.js/2.8.0-rc.1/Chart.min.css"]}},"waitSeconds":3})})
  })</script> <script type="text/javascript">
                  ;(function() {
                    var bp = document.createElement('script')
                    var curProtocol = window.location.protocol.split(':')[0]
                    if (curProtocol === 'https') {
                      bp.src = 'https://zz.bdstatic.com/linksubmit/push.js'
                    } else {
                      bp.src = 'http://push.zhanzhang.baidu.com/push.js'
                    }
                    var s = document.getElementsByTagName('script')[0]
                    s.parentNode.insertBefore(bp, s)
                  })()
                </script> 
